# 工具

1. 禁用按钮倒计时
    ```
    /**
     * 禁用按钮倒计时
     * @param {Object} element - DOM对象,按钮
     * @param {Number} time - 倒计时时间，默认60秒
     * @param {String} msg - 倒计时提示语
     */
    function showTimer(element, time, msg) {
        if (!arguments[1]) {
            time = 60;
        }
    
        if (!arguments[1]) {
            msg = "重新发送";
        }
    
        var countdown = time;
        var eText = element.innerHTML;
    
        function timer() {
            if (countdown === 0) {
                element.removeAttribute("disabled");
                element.innerHTML = eText;
                countdown = time;
                return;
            } else {
                element.setAttribute("disabled", true);
                element.innerHTML = msg + "(" + countdown + ")";
                countdown--;
            }
    
            setTimeout(function () {
                timer();
            }, 1000);
        }
    
        timer();
    }
    ```

2. 判断是否为空
    ```
     /**
     * 判断字符串是否为空
     * @param {String} str - 字符串
     * @returns {Boolean}
     */
    function isNull (str) {
        if (str == null || str == '' || typeof(str) == "undefined") {
            return true;
        } else {
            return false;
        }
    }
    ```

3. json格式转树状结构
    ```
    /**
     * json格式转树状结构(最大支持三级)
     * @param {Object} json数据
     * @param {String} id的字符串
     * @param {String} 父id的字符串
     * @param {Object} children的字符串
     * @return {Array} 数组
     */
     function transData(a, idStr, pidStr, chindrenStr) {
        var r = [],
            tr = [],
            hash = {},
            id = idStr,
            pid = pidStr,
            children = chindrenStr;
        for (i in a) {
            hash[a[i][id]] = a[i];
        }
        for (j in a) {
            var aVal = a[j],
                hashVP = hash[aVal[pid]];
            if (hashVP) {
                !hashVP[children] && (hashVP[children] = []);
                hashVP[children].push(aVal);
            } else {
                tr.push(aVal);
            }
        }
        for (k in tr) {
            tr[k]["level"] = 1;
            r.push(tr[k]);
            for (m in tr[k][children]) {
                tr[k][children][m]["level"] = 2;
                r.push(tr[k][children][m]);
                for (n in tr[k][children][m][children]) {
                    tr[k][children][m][children][n]["level"] = 3;
                    r.push(tr[k][children][m][children][n]);
                    for (i in tr[k][children][m][children][n][children]) {
                        tr[k][children][m][children][n][children][i]["level"] = 4;
                        r.push(tr[k][children][m][children][n][children][i]);
                    }
                }
            }
        }
        return {
            treeDatas: tr,
            treeList: r
        };
    }
    ```

4. 获取地址栏参数
    ```
    /**
     * 获取地址栏参数
     * @param {String} name - 参数名
     * @returns {String} 参数值
     */
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURI(r[2]);
        return null;
    }
    ```

5. 获取运行环境
    ```
    /**
     * 获取运行环境
     * @returns
     */
    var browserUtil = {
        versions: function () {
            var u = navigator.userAgent,
                app = navigator.appVersion;
            return {
                mobile: !!u.match(/AppleWebKit.*Mobile.*/), // 是否为移动终端
                ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), // ios终端
                android: u.indexOf('Android') > -1 || u.indexOf('Adr') > -1 // android终端
            };
        }(),
        isWeiXin: function () {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.match(/MicroMessenger/i) == "micromessenger") { // 在微信中打开
                return true;
            } else {
                return false;
            }
        }(),
        isQQ: function () {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.match(/QQ/i) == "qq") { // 在QQ空间打开
                return true;
            } else {
                return false;
            }
        }(),
        isWeiBo: function () {
            var ua = navigator.userAgent.toLowerCase();
            if (ua.match(/WeiBo/i) == "weibo") { // 在新浪微博客户端打开
                return true;
            } else {
                return false;
            }
        }(),
        language: (navigator.browserLanguage || navigator.language).toLowerCase()
    }
    ```

6. token生成
    ```
    /**
     * token生成
     * @param {Number} len - token长度
     * @returns {String} token
     */
    function randomString (len) {
        len = len || 16;
        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
        /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/
        var maxPos = $chars.length;
        var pwd = '';
        for (i = 0; i < len; i++) {
            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));
        }
        return pwd;
    }
    ```

7. 手机号隐藏中间几位号码
    ```
    /**
     * 手机号码隐藏中间四位
     * @param {Number} phone - 手机号
     * @returns {String} 处理后的手机号码
     */
    function formatPhone(phone){
        if(phone) {
            var regPhone= /(\d{4})\d{4}(\d{3})/;
            var phone= phone.replace(regPhone,"$1****$2");
            return phone;
        }else {
            return null;
        }
    }
    ```